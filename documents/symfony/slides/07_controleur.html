<!DOCTYPE html>


<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Les contrôleurs &mdash; Symfony 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/styles.css" type="text/css" />
    <link rel="stylesheet" href="_static/slides.css" type="text/css" />
    

    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/common.js"></script>
    <script type="text/javascript" src="_static/slides.js"></script>
    <script type="text/javascript" src="_static/sync.js"></script>
    <script type="text/javascript" src="_static/controller.js"></script>
    <script type="text/javascript" src="_static/init.js"></script>
    
    <link rel="top" title="Symfony 1.0.0 documentation" href="index.html" />
    <link rel="next" title="Les services" href="08_services.html" />
    <link rel="prev" title="Le routing" href="06_routing.html" /> 
  </head>
  <body>

<section
   id="slide_container"
   class='slides layout-regular'>


  <article class="slide level-1" id="les-controleurs">
<h1>Les contrôleurs</h1>

</article>
<article class="slide level-2" id="request-et-response">
<h2><tt class="docutils literal"><span class="pre">Request</span></tt> et <tt class="docutils literal"><span class="pre">Response</span></tt></h2>
<p>Comme vue précédemment, le contrôleur est le chef d'orchestre de votre application, il va utiliser les autres composants (services, modèles, vue) afin de construire la page demandé par l'internaute.</p>
<p>Peut importe ce que vous souhaitez faire, un contrôleur reçoit toujours un objet <tt class="docutils literal"><span class="pre">Request</span></tt> et doit toujours retourner un objet <tt class="docutils literal"><span class="pre">Response</span></tt>.
La demande de l'internaute se trouve dans un objet <tt class="docutils literal"><span class="pre">Request</span></tt> dans lequel le contrôleur toute les informations contenues dans la requête HTTP. La <tt class="docutils literal"><span class="pre">Response</span></tt> quant à elle correspond à la réponse HTTP.</p>

</article>
<article class="slide level-2" id="l-objet-request">
<h2>L'objet <tt class="docutils literal"><span class="pre">Request</span></tt></h2>
<p>La requête peut contenir des paramètres : l'Id d'un objet à afficher, un nom à chercher dans la base de données, etc. Ces paramètres peuvent être passés au contrôleurs via la route, des paramètres POST ou GET, etc.</p>

</article>
<article class="slide level-3" id="les-parametres-contenus-dans-les-routes">
<h3>Les paramètres contenus dans les routes</h3>
<p>Les paramètres passée par la route deviendront des arguments de la méthode appelée dans le contrôleur. Prenons cette route par exemple :</p>
<div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">epsi_blog_show</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">path</span><span class="p-Indicator">:</span>      <span class="l-Scalar-Plain">/post/{id}.{_format}</span>
    <span class="l-Scalar-Plain">defaults</span><span class="p-Indicator">:</span>  <span class="p-Indicator">{</span> <span class="nv">_controller</span><span class="p-Indicator">:</span> <span class="nv">EpsiBlogBundle</span><span class="p-Indicator">:</span><span class="nv">Blog</span><span class="p-Indicator">:</span><span class="nv">show</span><span class="p-Indicator">,</span> <span class="nv">_format</span><span class="p-Indicator">:</span> <span class="nv">html</span> <span class="p-Indicator">}</span>
    <span class="l-Scalar-Plain">requirements</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">id</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">\d+</span>
        <span class="l-Scalar-Plain">_format</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">html|xml|json</span>
</pre></div>
</div>
<p>La fonction appelée dans le contrôleur aura la définition suivante : <tt class="docutils literal"><span class="pre">public</span> <span class="pre">function</span> <span class="pre">showAction($id)</span></tt>.</p>

</article>
<article class="slide level-3" id="les-parametres-hors-routes">
<h3>Les paramètres hors routes</h3>
<p>Pour les autres paramètres ils peuvent tous être récupérés via l'objet <tt class="docutils literal"><span class="pre">Request</span></tt>. Il faut tout d'abord récupérer l'objet <tt class="docutils literal"><span class="pre">Request</span></tt> dans le contrôleur : <tt class="docutils literal"><span class="pre">$request</span> <span class="pre">=</span> <span class="pre">$this-&gt;getRequest();</span></tt>. Ensuite on peut récupérer les paramètres avec les méthodes suivantes :</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="19%" />
<col width="18%" />
<col width="44%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type de paramètres</th>
<th class="head">Méthode Symfony2</th>
<th class="head">Méthode traditionnelle</th>
<th class="head">Exemple</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Variables d'URL</td>
<td><tt class="docutils literal"><span class="pre">$request-&gt;query</span></tt></td>
<td><tt class="docutils literal"><span class="pre">$_GET</span></tt></td>
<td><tt class="docutils literal"><span class="pre">$request-&gt;query-&gt;get('tag')</span></tt></td>
</tr>
<tr class="row-odd"><td>Variables de formulaire</td>
<td><tt class="docutils literal"><span class="pre">$request-&gt;request</span></tt></td>
<td><tt class="docutils literal"><span class="pre">$_POST</span></tt></td>
<td><tt class="docutils literal"><span class="pre">$request-&gt;request-&gt;get('tag')</span></tt></td>
</tr>
<tr class="row-even"><td>Variables de cookie</td>
<td><tt class="docutils literal"><span class="pre">$request-&gt;cookies</span></tt></td>
<td><tt class="docutils literal"><span class="pre">$_COOKIE</span></tt></td>
<td><tt class="docutils literal"><span class="pre">$request-&gt;cookies-&gt;get('tag')</span></tt></td>
</tr>
<tr class="row-odd"><td>Variables de serveur</td>
<td><tt class="docutils literal"><span class="pre">$request-&gt;server</span></tt></td>
<td><tt class="docutils literal"><span class="pre">$_SERVER</span></tt></td>
<td><tt class="docutils literal"><span class="pre">$request-&gt;server-&gt;get('REQUEST_URI')</span></tt></td>
</tr>
<tr class="row-even"><td>Variables d'entête</td>
<td><tt class="docutils literal"><span class="pre">$request-&gt;headers</span></tt></td>
<td><tt class="docutils literal"><span class="pre">$_SERVER['HTTP*']</span></tt></td>
<td><tt class="docutils literal"><span class="pre">$request-&gt;headers-&gt;get('USER_AGENT')</span></tt></td>
</tr>
<tr class="row-odd"><td>Paramètres de route</td>
<td><tt class="docutils literal"><span class="pre">$request-&gt;attributes</span></tt></td>
<td>n/a</td>
<td><tt class="docutils literal"><span class="pre">$request-&gt;attributes-&gt;get('id')</span></tt>, est équivalent à <tt class="docutils literal"><span class="pre">$id</span></tt></td>
</tr>
</tbody>
</table>

</article>
<article class="slide level-3" id="les-autres-methodes-de-l-objet-request">
<h3>Les autres méthodes de l'objet <tt class="docutils literal"><span class="pre">Request</span></tt></h3>
<p>Une requête ne se compose pas que e paramètres et l'objet <tt class="docutils literal"><span class="pre">Request</span></tt> permet de les récupérer :</p>
<ul>
<li><dl class="first docutils">
<dt>récupérer la méthode de la requête HTTP :</dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">$request-&gt;getMethod()</span></tt></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>savoir si la requête est une requête AJAX :</dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">$request-&gt;isXmlHttpRequest()</span></tt></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>pour tout le reste :</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="http://api.symfony.com/2.6/Symfony/Component/HttpFoundation/Request.html">http://api.symfony.com/2.6/Symfony/Component/HttpFoundation/Request.html</a></li>
</ul>
</dd>
</dl>
</li>
</ul>

</article>
<article class="slide level-2" id="l-objet-response">
<h2>L'objet <tt class="docutils literal"><span class="pre">Response</span></tt></h2>
<p>Voici en version longue de qu'il faut faire pour construire et retourner une réponse :</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// on instancie une réponse</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">();</span>
    <span class="c1">// on définit le contenu</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="s1">&#39;Ceci est le contenu de la page&#39;</span><span class="p">);</span>
    <span class="c1">// on définit le code HTTP</span>
    <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setStatusCode</span><span class="p">(</span><span class="nx">Reponse</span><span class="o">::</span><span class="na">HTTP_OK</span><span class="p">);</span>
    <span class="c1">// on retourne la réponse</span>
    <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Mais généralement, on préfère utiliser les vues pour générer le contenu de la réponse :</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;EpsiBlogBundle:Blog:show.html.twig&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">,</span>
    <span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cette méthode est un raccourcie qui permet de générer une réponse en une seul ligne. Si vous souhaitez tout de même modifier certains éléments de la réponse (Content-Type, code de retour, durée du cache, etc.), on peut passer un objet <tt class="docutils literal"><span class="pre">Response</span></tt> en paramètre.</p>
<p>On peut également faire des redirections dans le contrôleur avec la méthode <tt class="docutils literal"><span class="pre">redirect()</span></tt>. La méthode <tt class="docutils literal"><span class="pre">generateUrl</span></tt> permet quant à elle de générer l'URL de la page de destination :</p>
<div class="highlight-php"><div class="highlight"><pre><span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">generateUrl</span><span class="p">(</span><span class="s1">&#39;epsi_blog_index&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;page&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">)));</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference external" href="http://api.symfony.com/2.6/Symfony/Component/HttpFoundation/Response.html">http://api.symfony.com/2.6/Symfony/Component/HttpFoundation/Response.html</a></p>

</article>


</section>

<section id="slide_notes">

</section>

  </body>
</html>